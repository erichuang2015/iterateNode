<!DOCTYPE html>
<html>
<head>
    <title>IterateNode Example</title>
    <link href="../src/css/iterateNode.css" rel="stylesheet" />
    <style>
        body{
            font-size:16px;
            overflow-x:hidden;
        }
    </style>
</head>
<body>

    <button onclick="action('anlyzJson')">Analyze Json</button>
    <button onclick="action('anlyzDocument')">Analyze documentElement</button>
    <button onclick="action('anlyzDocumentFiltered')">Analyze document body - Filtered</button>
    <button onclick="action('imadiv')">Analyze imadiv</button>
    <label>
        <span>Load a file:</span>
        <input type="file" id="inputFiles">
    </label>
    <div id="imadiv">
        imadiv
        <p>
            <b>imadiv<span>imadiv</span></b>
        </p>
    </div>
    <pre id="parseJs">

    </pre>
    <script src="../src/js/createCaret.js"></script>
    <script src="../src/js/iterateNode-documentFragment.js"></script>
    <script src="../src/js/sanitize.js"></script>
    <script src="../src/js/merge.js"></script>
    <script src="../src/js/assignParamFromString.js"></script>
    <script>
        var parseJsObject = document.getElementById("parseJs");
        function action(type){
            switch(type){
                case "anlyzJson":
                    var xmlhttp = new XMLHttpRequest();
                    xmlhttp.onreadystatechange = function() {
                        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                            var myJSONObject = JSON.parse(xmlhttp.responseText);
                            var iterateNodeSettings = {};
                            iterateNodeSettings.obj = myJSONObject;
                            iterateNodeSettings.Exclude = ["content"];
                            var parseJs = iterateNode(iterateNodeSettings);
                            parseJsObject.innerHTML = "";
                            parseJsObject.appendChild(parseJs);
                        }
                    };
                    xmlhttp.open("GET", "./JSON/example.json", true);
                    try {
                        xmlhttp.send();
                    }
                    catch(e){
                        alert("there seems to be a problem in REST connection ( maybe this page is not served by a Server? ) " +
                        "Try to load a file instead.")
                    }
                    break;
                case "anlyzDocument":
                    var iterateNodeSettings = {};
                    iterateNodeSettings.obj = document;
                    //iterateNodeSettings.Include = ["childNodes","children","innerText","parent","NodeList","html","body","HTMLCollection","tagName"];
                    var parseJs = iterateNode(iterateNodeSettings);
                    parseJsObject.innerHTML = "";
                    parseJsObject.appendChild(parseJs);
                    break;
                case "anlyzDocumentFiltered":
                    var objFilterFunction = function(obj){
                        var target = Array.isArray(obj) ? [] : {};
                        if ( Array.isArray(obj) ){
                            for(var i = 0;i<obj.length;i++) {
                                target.push(obj[i]);
                            }
                        }
                        if(typeof obj === "string")
                            target.innerText = obj;
                        else
                            target[obj.tagName] = obj;
                        return target;
                    };
                    var elementFilterFunction = function(property,obj){
                        var target = {};
                        if (property.tagName && Array.isArray(obj)) {
                            target[property.tagName] = property;
                            return target;
                        }
                        else
                            return property
                    };
                    var asyncFunction = function(obj,dataJSON,callback){
                        var target = [];
                        if( obj.children.length )
                            for(var i = 0; i<obj.children.length; i++){
                                target.push(obj.children[i]);
                            }
                        else if(obj.innerText)
                            target = obj.innerText;
                        else
                            target = "";
                        callback(target);
                    };
                    var iterateNodeSettings = {};
                    iterateNodeSettings.obj = document.body;
                    iterateNodeSettings.objFilterFunction = objFilterFunction;
                    iterateNodeSettings.elementFilterFunction = elementFilterFunction;
                    iterateNodeSettings.asyncFunction = asyncFunction;
                    var parseJs = iterateNode(iterateNodeSettings);
                    parseJsObject.innerHTML = "";
                    parseJsObject.appendChild(parseJs);
                    break;
                case "imadiv":
                    var iterateNodeSettings = {};
                    iterateNodeSettings.obj = document.getElementById("imadiv");
                    var parseJs = iterateNode(iterateNodeSettings);
                    parseJsObject.innerHTML = "";
                    parseJsObject.appendChild(parseJs);
                default:
                    break;
            }
        }
        var inputElement = document.getElementById("inputFiles");
        inputElement.addEventListener("change", handleFiles, false);
        function handleFiles() {
            var fileList = this.files;
            var reader = new FileReader();
            reader.onload = function(res){
                try{
                    var json = JSON.parse(res.target.result);
                    var iterateNodeSettings = {};
                    iterateNodeSettings.obj = document.getElementById("imadiv");
                    var parseJs = iterateNode(iterateNodeSettings);
                    parseJsObject.innerHTML = "";
                    parseJsObject.appendChild(parseJs);
                }
                catch(e){
                    alert("The file selected doesn't not appear to be a JSON")
                }
            };
            reader.readAsText(fileList[0]);
        }
    </script>
</body>
</html>