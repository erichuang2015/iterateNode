/* iterateNode0.0.1 2017-08-02 */

!function(){function a(a,b,c,d){for(var e=d||"?",f=a.split(e),g=b,h=0;h<f.length-1;h++)g=g[f[h]];g[f[f.length-1]]=c}function b(a,b,c,d){for(var e=d||"?",f=a.split(e),g=b,h=0;h<f.length-1;h++)g=g[f[h]];var i=g[f[f.length-1]];delete g[f[f.length-1]],g[c]=i}function c(a,b,c,d,e){for(var f=e||"?",g=a.split(f),h=b,i=0;i<g.length-1;i++)h=h[g[i]];var j=h[g[g.length-1]];j[c]=d}function d(a,b,c){if(!a)return b;for(var d=c||"?",e=a.split(d),f=b,g=0;g<e.length;g++)f=f[e[g]];return f}function e(a,b,c){for(var d=c||"?",e=a.split(d),f=b,g=0;g<e.length-1;g++)f=f[e[g]];if(Array.isArray(f[e])){var h=f[e].indexOf(f[e[e.length-1]]);f[e].splice(h,1)}else delete f[e[e.length-1]]}function f(a,b){var c=document.createElement("a");c.href="javascript:void()",c.className="caretA";var d=document.createElement("span");return d.className="caret",c.addEventListener("click",function(c){c.preventDefault(),c.stopPropagation();var e=a.querySelectorAll("ul")[0];e||(b.countObj=b.countObj+"-",b.asyncFunction?b.asyncFunction(a.getAttribute("data-string-model"),function(c){b.obj=c,a.appendChild(t(b))}):a.appendChild(t(b)));var f=/open/g;f.test(d.className)?(d.className=d.className.replace(f,""),e.className+=" simpleHide"):(d.className+=" open",e&&(e.className=e.className.replace(/simpleHide/g,"")))},!1),c.appendChild(d),c}function g(a){function b(a){a.preventDefault(),a.stopPropagation();var b=f.getAttribute("data-string-model"),i=b.split(s),j=d(b,r);if("undefined"!=typeof j){var k=g.getAttribute("data-string-model"),l=k.split(s);if(console.log("draggedStringModel, eventTargetStringModel",b,k),console.log("draggedPosition",j),e(b,r),h=h||g.querySelector("ul")?h:!0){var m=l.slice(0,l.length-1).join(s);console.log("parentStringNode",m),c(m,r,i[i.length-1],j),f.parentNode.removeChild(f),g.parentNode.appendChild(f)}else c(k,r,i[i.length-1],j),f.parentNode.removeChild(f),g.querySelector("ul").appendChild(f);f.style.opacity="",g.style.background="",p.style.display="none"}}var f=!1,g=!1,h=!1;document.addEventListener("drag",function(a){a.preventDefault(),a.stopPropagation()},!1),document.addEventListener("dragstart",function(a){"li"==a.target.nodeName.toLowerCase()&&(f=a.target,a.target.style.opacity=.5,a.dataTransfer.dropEffect="move")},!1),document.addEventListener("dragend",function(a){a.target.style.opacity="",p.style.display="none",a.dataTransfer.setData("dragging","false"),console.log("dragend")},!1),document.addEventListener("dragexit",function(a){a.target.style.opacity="",p.style.display="none",a.dataTransfer.setData("dragging","false"),console.log("dragexit")},!1),document.addEventListener("dragover",function(a){a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="move"},!1),document.addEventListener("dragenter",function(a){if(a.preventDefault(),a.stopPropagation(),g&&(g.style.background=""),"li"!=a.target.nodeName.toLowerCase()){if(g=k(a.target,"li"),!g)return;h=!0}else g=a.target,h=!1;var b=m(g);p.style.width=g.offsetWidth+b.left+"px",p.style.top=b.top+g.offsetHeight+7+"px",p.style.display="block",g.style.background="purple",a.dataTransfer.setData("dragging","true")},!1),document.addEventListener("dragleave",function(a){console.log("dragleave")},!1),document.addEventListener("drop",b,!0)}function h(a,b,e,g,h,i,j,k){a.insertAdjacentHTML("beforeend",g),addItems=a.querySelector(".add-items");var m=a.getAttribute("data-string-model"),n=d(m,e.originalObject);addItems.addEventListener("click",function(d){a.querySelector(".caretA")&&a.removeChild(a.querySelector(".caretA"));var g=Object.keys(n).length,h="[object Object]"==b?"key"+g:g;e.stringModel=m,c(m,e.originalObject,h,"value");var o=l({obj:i,stringModel:j,countObj:k},e,!0),p=f(a,o);a.querySelector("ul")?a.replaceChild(p,a.querySelector("ul")):a.appendChild(p),a.querySelector(".caretA").click()})}function i(c,e,f,g,h,i,j){c.querySelectorAll("[contenteditable]").forEach(function(d,h,k){d.addEventListener("blur",function(h){var k="[object Number]"==i&&d.className.indexOf("iterateNode-sanitize-key-value")<0?isNaN(Number(d.innerText))?0:Number(d.innerText):d.innerText;if(k="[object Boolean]"==i&&d.className.indexOf("iterateNode-sanitize-key-value")<0?"true"==d.innerText.toLowerCase():k,k!=d.innerText&&(d.innerText=k),d.className.indexOf("iterateNode-sanitize-key-value")>=0){var l=c.getAttribute("data-string-model"),m=l.split("?");m[m.length-1]=d.innerText;m.join("?");b(l,e.originalObject,d.innerText);var o=c.parentNode,p=o.parentNode.getAttribute("data-string-model");e.stringModel=p;var q=n(d.innerText,f,e,g);o.replaceChild(q,c)}else a(j,e.originalObject,k)})});var k=c.querySelector(".iterateNode-sanitize-key-typeof-value");k.addEventListener("click",function(b){var f=document.createElement("select"),i=document.createElement("option");f.appendChild(i);for(element in o){var i=document.createElement("option");i.value=element,i.innerHTML=o[element].label,f.appendChild(i)}c.children[0].replaceChild(f,k),f.addEventListener("change",function(b){var i=c.getAttribute("data-string-model"),j=o[f.value].converter();a(i,e.originalObject,j);var k=(d(i,e.originalObject),c.parentNode);e.stringModel=k.parentNode.getAttribute("data-string-model");var l=n(h,j,e,g);k.replaceChild(l,c)})})}function j(a,b){var c=document.createElement("i");c.className="iterateNode-delete-item",c.innerHTML="-",a.appendChild(c),c.addEventListener("click",function(c){var d=a.getAttribute("data-string-model");e(d,b.originalObject),a.parentNode.removeChild(a)})}function k(a,b){for(console.log("el, el.parentNode ",a,a.parentNode);a.parentNode;)if(a=a.parentNode,a.nodeName.toLowerCase()==b)return a;return null}function l(a,b,c){var d=Array.isArray(b)?[]:{};for(var e in b){var f=Object.prototype.toString.call(b[g]);"[object Object]"!=f&&"[object Array]"!=f||!b[e]?d[e]=a[e]||b[e]:d[e]=a[e]?l(a[e],b[e],c):b[e]}if(c)for(var g in a)d[g]=d[g]||a[g];return d}function m(a){var b={top:0,left:0},c=document.documentElement,d=window,e="undefined";return typeof a.getBoundingClientRect!==e&&(b=a.getBoundingClientRect()),{top:b.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:b.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}}function n(a,b,c,d){var e=Object.prototype.toString.call(b),g=e;if(c.typeOfFilter){var k=c.typeOfFilter(e,b);g=k.typeofValue,b=k.node,e=Object.prototype.toString.call(b)}var m=c.stringModel&&c.stringModel.length?c.stringModel+"?"+a:a,n=c.countObj+d,o=c.sanitizedObjects.indexOf(a)>-1?"node-iterator-text-content":"",p=c.contentEditable?" contenteditable ":"",q=!c.contentEditable||"[object Object]"!=e&&"[object Array]"!=e?"":"<span class='add-items'>+</span>",r=document.createElement("li");if(r.id="iterateNode-"+n,r.setAttribute("data-string-model",m),r.setAttribute("data-type-of",e),r.className="iterateNode-"+e.replace(/[\[\]]/g,"").replace(/\s+/,"-"),r.innerHTML="<span class='"+o+"'><i class='iterateNode-sanitize-key'>"+c.key+"</i><b class='iterateNode-sanitize-key-value'"+p+">"+a+"</b><span class='iterateNode-sanitize-separator1'>"+c.Separator1+"</span><span class='iterateNode-sanitize-key-typeof'>"+c.Typeof+"</span><i class='iterateNode-sanitize-key-typeof-value' data-value='"+g+"'>"+g+"</i></span>",c.sanitizedObjects.indexOf(a)>-1){var s=u(b);r.innerHTML+="<pre class='iterateNode-sanitizedHTML'>"+s+"</pre>"}else if("object"==typeof b&&b)if("[object Object]"!=e&&"[object Array]"!=e||Object.keys(b).length||c.asyncFunction){var t=l({obj:b,stringModel:m,countObj:n},c,!0),v=f(r,t);r.appendChild(v)}else;else c.sanitizedObjects.indexOf(a)<0&&(r.innerHTML+=null!=b?"<span class='iterateNode-sanitize-separator2'>"+c.Separator2+"</span><b class='iterateNode-sanitize-value'"+p+">"+b+"</b>":" null");return c.contentEditable&&(i(r,c,b,d,a,e,m),j(r,c)),c.contentEditable&&q&&h(r,e,c,q,d,b,m,n),c.contentEditable&&c.dragging&&r.setAttribute("draggable","true"),r}var o={"[object Number]":{label:"number",converter:function(){return Number()}},"[object String]":{label:"string",converter:function(){return String()}},"[object Boolean]":{label:"boolean",converter:function(){return Boolean()}},"[object Array]":{label:"list of values",converter:function(a){return[]}},"[object Object]":{label:"list of elements",converter:function(a){return{}}},"[object Null]":{label:"null",converter:function(a){return null}}},p=document.getElementById("drag-highlight"),q={countObj:"",stringModel:"",stringModelSeparator:"?",key:"key:",Separator1:" -- ",Typeof:"typeof:",Separator2:" -- ",Include:[],Exclude:[],sanitizedObjects:["outerText","innerText","innerHTML","outerHTML"]},r={},s="",t=function(a){var b=document.createDocumentFragment(),c=document.createElement("ul");c.className="iterateNode-obj",a.name&&(c.id=a.name,a.name=null);var d=0,e=a.filterFunction?a.filterFunction(a.obj):a.obj;a.flatArrays;a.originalObject||(a.originalObject=a.obj),r=a.originalObject;var f=l(a,q,!0);s=f.stringModelSeparator;for(var h in e){var i=n(h,e[h],f,d);c.appendChild(i),d++}return b.appendChild(c),f.contentEditable&&f.dragging&&!f["dragging-init"]&&(f["dragging-init"]=!0,g(f)),b};!function(){var a=function(a,b,c){c=c||window;var d=!1,e=function(){d||(d=!0,requestAnimationFrame(function(){c.dispatchEvent(new CustomEvent(b)),d=!1}))};c.addEventListener(a,e)};a("resize","optimizedResize")}();var u=function(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a};window.iterateNode=t}();
//# sourceMappingURL=iterateNode.min.js.map