/* iterateNode0.0.1 2018-08-28 */

!function(){function a(a){var b=document.createElement("select");b.classList.add("iterate-node__hide");for(var c in y){var d=document.createElement("option");d.value=c,b.options.add(new Option(y[c].label,c))}return b}function b(a){function b(b){if(!h&&b.target.classList.contains("iterate-node__drag")&&m(a,b.target)){h=!0;var c=b.target.parentElement,d=c.cloneNode(!0);d.querySelector("ul")&&d.removeChild(d.querySelector("ul")),i.push({original:c,clone:d});for(var e in i)j.appendChild(i[e].clone);j.style.transform="translate("+b.x+"px,"+b.y+"px)"}}function c(b){if(h&&m(a,b.target)){e=b.target;var c=e.nodeName.toLowerCase(),d=e.parentElement.nodeName.toLowerCase();if(f="li"==c?e:"li"==d?e.parentElement:!1){var g=0;if("ul"==c){f.querySelector(".iterate-node__caret");g=f.offsetHeight}j.style.transform="translate("+(b.x+1)+"px,"+(b.y+1)+"px)";var i=x(f);k.style.width=f.offsetWidth+i.left+"px",k.style.transform="translate(0,"+(i.top+g)+"px)"}}}function d(b){if(h){if(m(a,b.target)&&f)for(var c in i){var d=i[c].original;if(d!=f&&!m(d,f)){var g=d[z.dataKeyOnDOM].key;t(d);var l=d[z.dataKeyOnDOM].value,n="ul"==e.nodeName.toLowerCase()?!1:f,o="undefined"==typeof f[z.dataKeyOnDOM].key||"ul"==e.nodeName.toLowerCase()?f:f.parentElement.parentElement;p(o,n,l,g,d)}}h=!1,j.innerHTML="",i=[],j.style.transform="translate(-9999px,-9999px)",k.style.transform="translate(-9999px,-9999px)"}}var e,f,g=this,h=!1,i=[],j=document.querySelector(".iterate_node__dummy");j||(j=document.createElement("div"),j.classList.add("iterate_node__dummy"),document.body.appendChild(j));var k=document.querySelector(".iterate-node__drag-position");k||(k=document.createElement("div"),k.classList.add("iterate-node__drag-position"),document.body.appendChild(k));var l=function(){function e(a){var c={x:a.pageX,y:a.pageY,target:a.target};b(c)}function f(a){var b={x:a.pageX,y:a.pageY,target:a.target};d(b)}function h(a){var b={x:a.pageX,y:a.pageY,target:a.target};c(b)}a.addEventListener("mousedown",e),document.addEventListener("mouseup",f),document.addEventListener("mousemove",h),g.destroy=function(){a.removeEventListener("mousedown",e),document.removeEventListener("mouseup",f),document.removeEventListener("mousemove",h)}},n=function(){function e(a){var c={x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,target:a.target};b(c),document.addEventListener("touchend",h,!1),document.addEventListener("touchmove",h,!1)}function f(a){var b={x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,target:document.elementFromPoint(a.changedTouches[0].pageX,a.changedTouches[0].pageY)};c(b)}function h(a){var b={x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,target:a.target};d(b),document.removeEventListener("touchend",h),document.removeEventListener("touchmove",f,{passive:!1})}a.addEventListener("touchstart",e,{passive:!0}),g.destroy=function(){a.removeEventListener("touchstart",e)}};/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?n():l()}function c(a){var b=document.createElement("ul"),c=document.createElement("li"),f=z.map?z.map(a):a;return c[z.dataKeyOnDOM]={value:f,alias:a},z.alias&&e(c,z.alias(a)),z.contentEditable.add&&d(c),b.appendChild(c),b}function d(a,b){var c=document.createElement("span");c.classList.add("iterate-node__add-item"),c.textContent="+",c.addEventListener("click",function(b){p(a,null,null,void 0,null)}),a.appendChild(c)}function e(a,b){var c=document.createElement("span");c.classList.add("iterate-node__alias"),c.innerHTML=b,a.appendChild(c)}function f(a){var b=document.createElement("span");b.classList.add("iterate-node__caret"),b.addEventListener("click",v),a.appendChild(b)}function g(a){var b=document.createElement("span");b.innerText="-",b.addEventListener("click",t.bind(null,a)),a.appendChild(b)}function h(a){var b=document.createElement("span");b.classList.add("iterate-node__drag"),b.innerText="D",a.appendChild(b)}function i(a,b,c,d){var e=document.createElement("span");e.classList.add("iterate-node__key"),e.innerText=b,z.contentEditable.key&&!Array.isArray(c)&&(e.setAttribute("contenteditable","true"),e.addEventListener("blur",q.bind(null,a,d,!0))),a.appendChild(e)}function j(b,c,d){var e=document.createElement("span");if(e.classList.add("iterate-node__type-node"),e.innerText=c,b.appendChild(e),z.contentEditable.type){e.addEventListener("click",r);var f=a();b.appendChild(f),f.addEventListener("blur",s.bind(null))}}function k(a){var b=document.createElement("span");b.innerText=":",b.classList.add("iterate-node__separator"),a.appendChild(b)}function l(a,b,c){var d=document.createElement("span");d.classList.add("iterate-node__value"),d.textContent=""+b,z.contentEditable.value&&(d.setAttribute("contenteditable","true"),d.addEventListener("blur",q.bind(null,a,c,!1))),a.appendChild(d)}function m(a,b){for(var c=b.parentNode;null!=c;){if(c==a)return!0;c=c.parentNode}return!1}function n(a,d){var e=this;z=e.defaults=d?o(d,z,!0):z,e.state=z.obj,e.methods=A;var f=u(z.obj),g=c(z.obj);return g.children[0].appendChild(f),a.className+=" iterateNode-obj",a.appendChild(g),z.contentEditable.drag&&b.call(this,a),e}function o(a,b,c){var d=Array.isArray(b)?[]:{};for(var e in b){var f=Object.prototype.toString.call(b[g]);"[object Object]"!=f&&"[object Array]"!=f||!b[e]?d[e]=a[e]||b[e]:d[e]=a[e]?o(a[e],b[e],c):b[e]}if(c)for(var g in a)d[g]=d[g]||a[g];return d}function p(a,b,c,d,e,f){var g=a[z.dataKeyOnDOM].value,h=a.querySelector("ul"),i=a.querySelector(".iterate-node__caret");i&&(h||(i.click(),h=a.querySelector("ul")),i.classList.contains("open")||i.classList.add("open"));var j;if(Array.isArray(g))if("undefined"==typeof d&&(c="value",d=g.length),b){j=Array.prototype.indexOf.call(b.parentElement.children,b);for(var k=b.parentElement.children.length,l=j;k>l;l++){var m=b.parentElement.children[l];m[z.dataKeyOnDOM].key=l+1,m.querySelector(".iterate-node__key").innerText=l+1}g.splice(j,0,c),e&&(e.querySelector(".iterate-node__key").innerText=j,e[z.dataKeyOnDOM].key=j),d=j}else e&&(e.querySelector(".iterate-node__key").innerText=g.length,e[z.dataKeyOnDOM].key=g.length),g[g.length]=c;else{if("undefined"==typeof d){var n=0;for(var o in g)if(0===o.indexOf("newItem")){var p=Number(o.replace("newItem",""));n=!isNaN(p)&&p>n?p:n}c="value",d="newItem"+(n+1)}else{for(;Object.keys(g).indexOf(d)>-1;)d+=Math.floor(9007199254740991*Math.random());e&&(e.querySelector(".iterate-node__key").innerText=d,e[z.dataKeyOnDOM].key=d)}if(b){var q=b[z.dataKeyOnDOM].key,r=JSON.parse(JSON.stringify(g));for(var s in g)delete g[s];for(var t in r)t==q?(g[d]=c,g[t]=r[t]):g[t]=r[t]}else g[d]=c}e&&(e[z.dataKeyOnDOM].parentElement=g);var u=e?e:w(d,c,g,f||null);b?b.parentElement.insertBefore(u,b):h.appendChild(u),z.addElementListener&&z.addElementListener(u[z.dataKeyOnDOM],a[z.dataKeyOnDOM],b?b[z.dataKeyOnDOM]:!1)}function q(a,b,c,d){var e=d.target,f=a.parentElement.parentElement[z.dataKeyOnDOM].value,g=e.innerText;if(c){for(;Object.keys(f).indexOf(g)>-1;)g+=Math.floor(9007199254740991*Math.random());a[z.dataKeyOnDOM].key=g,e.innerText=g,z.changeKeyListener&&z.changeKeyListener(a[z.dataKeyOnDOM])}else{switch(b){case"[object Number]":g=isNaN(Number(g))?0:Number(g);break;case"[object Boolean]":g="true"==g.toLowerCase()}a[z.dataKeyOnDOM].value=g,z.changeValueListener&&z.changeValueListener(a[z.dataKeyOnDOM])}}function r(a){a.target.classList.add("iterate-node__hide"),a.target.nextElementSibling.classList.remove("iterate-node__hide")}function s(a){var b=a.target.parentElement,c=b[z.dataKeyOnDOM].key,d=b.parentElement.parentElement[z.dataKeyOnDOM].value,e=y[a.target.value].converter();b.parentElement.replaceChild(w(c,e,d),b),b[z.dataKeyOnDOM].value=e,d[c]=e,z.changeTypeListener&&z.changeTypeListener(b[z.dataKeyOnDOM])}function t(a){var b=a[z.dataKeyOnDOM].parentElement,c=a[z.dataKeyOnDOM].key;if(Array.isArray(b)){for(var d=a.parentElement,e=Array.prototype.indexOf.call(d.children,a),f=d.children.length,g=e+1;f>g;g++){var h=d.children[g];h[z.dataKeyOnDOM].key=g-1,h.querySelector(".iterate-node__key").innerText=g-1}b.splice(e,1)}else delete b[c];z.removeElementListener&&z.removeElementListener(a[z.dataKeyOnDOM]),a.parentElement.removeChild(a)}function u(a){var b=document.createElement("ul");if(z.map){var c=z.map(a);for(var d in c)b.appendChild(w(d,c[d].value,c,c[d].alias))}else for(var d in a)b.appendChild(w(d,a[d],a));return b}function v(a){var b=a.target,c=b.parentElement,d=c.querySelector("ul");if(!d){var e=c[z.dataKeyOnDOM].value,f=u(e);c.appendChild(f)}b.classList.toggle("open")}function w(a,b,c,m){var n=Object.prototype.toString.call(b),o=document.createElement("li");if(o[z.dataKeyOnDOM]={key:a,value:b,parentElement:c,alias:m},z.contentEditable.drag&&h(o),i(o,a,c,n),j(o,n,a),k(o),z.alias&&e(o,z.alias(m)),b&&"object"==typeof b?(f(o),z.contentEditable.add&&d(o)):z.alias||l(o,b,n),z.contentEditable["delete"]&&g(o),Object.keys(z.appendElements).length)for(var p in z.appendElements)z.appendElements[p](a,b);return o}function x(a){var b={top:0,left:0},c=document.documentElement,d=window,e="undefined";return typeof a.getBoundingClientRect!==e&&(b=a.getBoundingClientRect()),{top:b.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0),left:b.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0)}}var y={"[object Number]":{label:"number",converter:function(){return Number()}},"[object String]":{label:"string",converter:function(){return String()}},"[object Boolean]":{label:"boolean",converter:function(){return Boolean()}},"[object Array]":{label:"list of values",converter:function(a){return[]}},"[object Object]":{label:"list of elements",converter:function(a){return{}}},"[object Null]":{label:"null",converter:function(a){return null}}},z={separator:".",contentEditable:{add:!1,"delete":!1,key:!1,value:!1,selection:!1,drag:!1,type:!1},appendElements:{},map:!1,dataKeyOnDOM:"__iterate-node-data__"},A={addElement:p,changeKeyOrValue:q,changeType:s,deleteElement:t,openObject:v,iteration:u,template:w};window.iterateNode=n}();
//# sourceMappingURL=iterateNode.min.js.map